---
- name: Verify vector-role
  hosts: all
  become: true
  tasks:
    - name: Vector binary should exist
      ansible.builtin.stat:
        path: /usr/bin/vector
      register: vector_bin

    - name: Assert vector binary present
      ansible.builtin.assert:
        that:
          - vector_bin.stat.exists
        fail_msg: "Vector binary not found at /usr/bin/vector"

    - name: Config file should exist
      ansible.builtin.stat:
        path: "{{ vector_config_path | default('/etc/vector/vector.yaml') }}"
      register: vector_cfg

    - name: Assert config file present
      ansible.builtin.assert:
        that:
          - vector_cfg.stat.exists
        fail_msg: "Vector config not found"

    - name: Validate config (if vector supports validate)
      ansible.builtin.command: >
        vector validate --no-environment --config-yaml {{ vector_config_path | default('/etc/vector/vector.yaml') }}
      register: vector_validate
      changed_when: false
      failed_when: vector_validate.rc != 0

    - name: Check vector version
      ansible.builtin.command: vector --version
      register: vector_version
      changed_when: false
      failed_when: vector_version.rc != 0
